<view class="page">
  <view class="card header">
    <text class="title">全部练习记录</text>

    <view class="range-text">
      <text>{{rangeText}}</text>
    </view>
  </view>

  <view class="card">
    <text class="section-title">统计</text>
    <view class="stats-grid">
      <view class="stat">
        <text class="stat-value">{{stats.totalHours}}</text>
        <text class="stat-label">累计时长(小时)</text>
      </view>
      <view class="stat">
        <text class="stat-value">{{stats.totalSessions}}</text>
        <text class="stat-label">练习次数</text>
      </view>
      <view class="stat">
        <text class="stat-value">{{stats.checkinDays}}</text>
        <text class="stat-label">打卡天数</text>
      </view>
      <view class="stat">
        <text class="stat-value">{{stats.avgSessionMinutes}}</text>
        <text class="stat-label">平均每次(分钟)</text>
      </view>
      <view class="stat">
        <text class="stat-value">{{stats.avgCheckinMinutes}}</text>
        <text class="stat-label">平均每天(分钟)</text>
      </view>
      <view class="stat">
        <text class="stat-value">{{stats.maxDailyMinutes}}</text>
        <text class="stat-label">单日最高(分钟)</text>
      </view>
      <view class="stat">
        <text class="stat-value">{{stats.songCount}}</text>
        <text class="stat-label">累计曲目</text>
      </view>
    </view>

    <view class="note" wx:if="{{stats.topSongs && stats.topSongs.length > 0}}">
      <text class="note-title">曲目概览 · 练习次数前五</text>
      <view class="bar-list">
        <view class="bar-item" wx:for="{{stats.topSongs}}" wx:key="name">
          <text class="bar-label">{{item.name}}</text>
          <view class="bar-track">
            <view class="bar-fill" style="width: {{item.percent}}%;"></view>
          </view>
          <text class="bar-value">{{item.count}}次</text>
        </view>
      </view>
    </view>

    <view class="note" wx:if="{{stats.timeBuckets && stats.timeBuckets.length > 0}}">
      <text class="note-title">练习时段偏好</text>
      <view class="bar-list">
        <view class="bar-item" wx:for="{{stats.timeBuckets}}" wx:key="label">
          <text class="bar-label">{{item.label}}</text>
          <view class="bar-track is-soft">
            <view class="bar-fill is-soft" style="width: {{item.percent}}%;"></view>
          </view>
          <text class="bar-value">{{item.count}}次</text>
        </view>
      </view>
    </view>

    <view class="note" wx:if="{{stats.newSongs && stats.newSongs.length > 0}}">
      <text class="note-title">近期新增曲目</text>
      <view class="new-song-list">
        <view class="new-song-item" wx:for="{{stats.newSongs}}" wx:key="name">
          <text class="new-song-name">{{item.name}}</text>
          <text class="new-song-date">{{item.date}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="card">
    <text class="section-title">练习明细</text>
    <view class="filter">
      <text class="filter-label">按时间查询</text>
      <view class="filter-row">
        <picker mode="date" value="{{filterStart}}" bindchange="onFilterStartChange">
          <view class="filter-box">
            <text>{{filterStart || '开始日期'}}</text>
          </view>
        </picker>
        <text class="filter-sep">至</text>
        <picker mode="date" value="{{filterEnd}}" bindchange="onFilterEndChange">
          <view class="filter-box">
            <text>{{filterEnd || '结束日期'}}</text>
          </view>
        </picker>
        <view class="filter-reset" bindtap="onResetFilter">重置</view>
      </view>
      <text class="filter-hint">{{filterHint}}</text>
    </view>
    <view wx:if="{{recordGroups.length===0}}" class="empty">
      <text>暂无练习记录</text>
    </view>
    <view wx:for="{{recordGroups}}" wx:key="date" class="record-group">
      <text class="record-date">{{item.date}}</text>
      <view wx:for="{{item.items}}" wx:key="id" class="record-item">
        <view class="record-item-main compact">
          <text class="record-song">{{item.song}}</text>
        </view>
        <view class="record-meta-row">
          <text class="record-time">打卡时间 {{item.timeLabel}}</text>
          <text class="record-duration">{{item.durationLabel}}</text>
          <text class="record-repeat">{{item.repeatLabel}}</text>
        </view>
        <text wx:if="{{item.notes}}" class="record-notes">{{item.notes}}</text>
        <text wx:if="{{item.notesLabel}}" class="record-notes-hint">{{item.notesLabel}}</text>
      </view>
    </view>
  </view>
</view>
